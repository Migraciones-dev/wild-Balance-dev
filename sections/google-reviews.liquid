{% comment %}
  Sección: Cómo funciona nuestra suscripción (editable desde el editor de temas)
  - Fondo, colores y assets configurables en "Ajustes"
  - Título dividido en prefijo + highlight
  - Cada bloque = un slide (avatar, nombre, texto y estrellas)
  - Marquee/slider horizontal sin JS (duplicamos los bloques)
{% endcomment %}

<section
  id="mig-suscripcion-{{ section.id }}"
  class="flex flex-col items-center gap-20 max-w-[1600px] mx-auto pb-16 md:py-24"
  style="background-color: {{ section.settings.bg_color }};"
>
  <style>
    #mig-suscripcion-{{ section.id }}{
      --title-color: {{ section.settings.title_color }};
      --highlight-color: {{ section.settings.highlight_color }};
      --text-color: {{ section.settings.text_color }};
      --accent-color: {{ section.settings.accent_color }};
    }
    #mig-suscripcion-{{ section.id }} .mig-title{color:var(--title-color)}
    #mig-suscripcion-{{ section.id }} .mig-text{color:var(--text-color)}
    #mig-suscripcion-{{ section.id }} .highlight{color:var(--highlight-color)}
    #mig-suscripcion-{{ section.id }} .step-badge{background:var(--accent-color)}
    #mig-suscripcion-{{ section.id }} .btn-primary{background:var(--accent-color);color:var(--title-color)}
    #mig-suscripcion-{{ section.id }} .btn-primary:hover{opacity:.9}
    #mig-suscripcion-{{ section.id }} .no-scrollbar{scrollbar-width:none}
    #mig-suscripcion-{{ section.id }} .no-scrollbar::-webkit-scrollbar{display:none}
  </style>

  <!-- Título -->
  <div class="flex flex-col items-center gap-[13px] [@media(max-width:1024px)]:px-6">
    {% if section.settings.decor_image != blank %}
      <div class="flex flex-col items-center gap-2.5 relative overflow-hidden">
        <img
          class="relative h-[27px] sm:h-[37px] lg:h-[47px]"
          alt="{{ section.settings.decor_image_alt | escape }}"
          src="{{ section.settings.decor_image | image_url }}"
          loading="lazy"
        >
      </div>
    {% endif %}

    {% if section.settings.title_prefix %}
      <div class="relative w-full text-center [@media(max-width:1024px)]:px-6">
        <h2 class="mig-title [font-family:'Barlow',Helvetica] font-extrabold max-w-[1600px] text-[30px] lg:text-[64px] lg:text-center leading-[1]">
          {{ section.settings.title_prefix }}
          <span class="highlight">{{ section.settings.title_highlight }}</span>
        </h2>
      </div>
    {% endif %}
  </div>

  <!-- REVIEWS -->
  {% assign slides_count = section.blocks.size | default: 0 %}

  <div class="slider">
    <div class="slide-track">
      {%- for block in section.blocks -%}
        <article
          style="border: 1px solid #0000000a; margin-right: 15px;"
          class="slide h-full rounded-2xl border bg-white p-5 shadow-sm w-full sm:w-1/3 lg:w-1/4 min-h-[442px] pb-24 pb-24"
          {{ block.shopify_attributes }}
        >
          <header class="mb-3 flex items-center justify-between">
            <div class="flex items-center gap-3">
              {% if block.settings.avatar != blank %}
                <img
                  src="{{ block.settings.avatar | image_url: width: 128 }}"
                  class="h-14 w-14 rounded-full object-cover"
                  alt="{{ block.settings.avatar_alt | escape }}"
                  loading="lazy"
                >
              {% else %}
                <img
                  src="https://i.pravatar.cc/64?u={{ block.id }}"
                  class="h-14 w-14 rounded-full object-cover"
                  alt=""
                  loading="lazy"
                >
              {% endif %}
              <div>
                <p class="font-medium leading-none ml-4 text-[#1A1A1A]">{{ block.settings.name }}</p>
              </div>
            </div>

            <!-- Icono Google fijo -->
            <svg class="h-10 w-10" viewBox="0 0 48 48" aria-hidden="true">
              <path fill="#FFC107" d="M43.6 20.5H42V20H24v8h11.3C33.7 32.5 29.3 36 24 36a12 12 0 110-24c3 0 5.7 1.1 7.8 2.9l5.7-5.7C34.5 6.1 29.5 4 24 4 12.9 4 4 12.9 4 24s8.9 20 20 20 19.5-8.9 19.5-20c0-1.3-.1-2.2-.4-3.5z"/><path fill="#FF3D00" d="M6.3 14.7l6.6 4.8C14.6 16.3 18.9 12 24 12c3 0 5.7 1.1 7.8 2.9l5.7-5.7C34.5 6.1 29.5 4 24 4 16.1 4 9.3 8.4 6.3 14.7z"/><path fill="#4CAF50" d="M24 44c5.2 0 10.1-2 13.6-5.4l-6.3-5.2C29.2 35.7 26.8 36 24 36c-5.2 0-9.6-3.5-11.2-8.2l-6.6 5.1C9.2 39.6 16 44 24 44z"/><path fill="#1976D2" d="M43.6 20.5H42V20H24v8h11.3c-1.3 3.9-5.4 6.5-11.3 6.5-5.2 0-9.6-3.5-11.2-8.2l-6.6 5.1C9.2 39.6 16 44 24 44c11.1 0 19.5-8.9 19.5-20 0-1.3-.1-2.2-.4-3.5z"/>
            </svg>
          </header>

          <div class="mt-1 flex items-center gap-1 py-4" aria-label="{{ block.settings.rating }} de 5">
            {% for i in (1..block.settings.rating) %}
              <!-- Estrella rellena -->
              <svg
                width="21"
                height="20"
                viewBox="0 0 21 20"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <path d="M20.1275 7.62538C20.0635 7.42715 19.9427 7.25212 19.7799 7.12212C19.6172 6.99211 19.4198 6.91289 19.2124 6.89432L13.4399 6.37022L11.1572 1.02752C11.0753 0.836142 10.939 0.673015 10.7652 0.558367C10.5915 0.443719 10.3879 0.382593 10.1797 0.382568C9.97143 0.38259 9.76773 0.443825 9.59395 0.558661C9.42017 0.673498 9.28397 0.836872 9.20228 1.02848L6.91959 6.37022L1.14625 6.89443C0.939067 6.9134 0.742012 6.99277 0.579513 7.12268C0.417015 7.2526 0.296219 7.42735 0.232104 7.62527C0.167485 7.82324 0.162501 8.03583 0.217773 8.23661C0.273044 8.43738 0.386132 8.61747 0.542964 8.75447L4.9063 12.5811L3.6197 18.2489C3.57329 18.4522 3.58773 18.6646 3.66122 18.8598C3.73471 19.0549 3.86399 19.2241 4.03297 19.3463C4.21393 19.4778 4.43184 19.5488 4.65554 19.549C4.84761 19.5488 5.03599 19.4963 5.20053 19.3972L10.1798 16.4213L15.1573 19.3972C15.3356 19.5044 15.5414 19.5568 15.7492 19.5477C15.957 19.5387 16.1575 19.4686 16.3257 19.3463C16.4947 19.2241 16.6239 19.0548 16.6974 18.8597C16.7709 18.6646 16.7855 18.4522 16.7392 18.2489L15.4525 12.5811L19.8158 8.75532C19.9728 8.61822 20.086 8.43803 20.1414 8.23712C20.1969 8.03622 20.192 7.82346 20.1276 7.62527Z" fill="#FBBF24"/>
              </svg>
            {% endfor %}
          </div>

          <p class="text-sm leading-6 text-gray-700">{{ block.settings.text }}</p>
        </article>
      {%- endfor -%}

      {%- comment -%} Duplicado para loop continuo {%- endcomment -%}
      {%- for block in section.blocks -%}
        <article
          style="border: 1px solid #0000000a; margin-right: 15px;"
          class="slide h-full rounded-2xl border bg-white p-5 shadow-sm w-full sm:w-1/3 lg:w-1/4 min-h-[442px] pb-24 pb-24"
          aria-hidden="true"
        >
          <header class="mb-3 flex items-center justify-between">
            <div class="flex items-center gap-3">
              {% if block.settings.avatar != blank %}
                <img
                  src="{{ block.settings.avatar | image_url: width: 128 }}"
                  class="h-14 w-14 rounded-full object-cover"
                  alt=""
                  loading="lazy"
                >
              {% else %}
                <img
                  src="https://i.pravatar.cc/64?u={{ block.id }}"
                  class="h-14 w-14 rounded-full object-cover"
                  alt=""
                  loading="lazy"
                >
              {% endif %}
              <div>
                <p class="font-medium leading-none ml-4 text-[#1A1A1A]">{{ block.settings.name }}</p>
              </div>
            </div>
            <svg class="h-10 w-10" viewBox="0 0 48 48" aria-hidden="true">
              <path fill="#FFC107" d="M43.6 20.5H42V20H24v8h11.3C33.7 32.5 29.3 36 24 36a12 12 0 110-24c3 0 5.7 1.1 7.8 2.9l5.7-5.7C34.5 6.1 29.5 4 24 4 16.1 4 9.3 8.4 6.3 14.7z"/><path fill="#FF3D00" d="M6.3 14.7l6.6 4.8C14.6 16.3 18.9 12 24 12c3 0 5.7 1.1 7.8 2.9l5.7-5.7C34.5 6.1 29.5 4 24 4 16.1 4 9.3 8.4 6.3 14.7z"/><path fill="#4CAF50" d="M24 44c5.2 0 10.1-2 13.6-5.4l-6.3-5.2C29.2 35.7 26.8 36 24 36c-5.2 0-9.6-3.5-11.2-8.2l-6.6 5.1C9.2 39.6 16 44 24 44z"/><path fill="#1976D2" d="M43.6 20.5H42V20H24v8h11.3c-1.3 3.9-5.4 6.5-11.3 6.5-5.2 0-9.6-3.5-11.2-8.2l-6.6 5.1C9.2 39.6 16 44 24 44c11.1 0 19.5-8.9 19.5-20 0-1.3-.1-2.2-.4-3.5z"/>
            </svg>
          </header>
          <div class="mt-1 flex items-center gap-1 py-4" aria-hidden="true">
            {% for i in (1..block.settings.rating) %}
              <svg
                width="21"
                height="20"
                viewBox="0 0 21 20"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <path d="M20.1275 7.62538C20.0635 7.42715 19.9427 7.25212 19.7799 7.12212C19.6172 6.99211 19.4198 6.91289 19.2124 6.89432L13.4399 6.37022L11.1572 1.02752C11.0753 0.836142 10.939 0.673015 10.7652 0.558367C10.5915 0.443719 10.3879 0.382593 10.1797 0.382568C9.97143 0.38259 9.76773 0.443825 9.59395 0.558661C9.42017 0.673498 9.28397 0.836872 9.20228 1.02848L6.91959 6.37022L1.14625 6.89443C0.939067 6.9134 0.742012 6.99277 0.579513 7.12268C0.417015 7.2526 0.296219 7.42735 0.232104 7.62527C0.167485 7.82324 0.162501 8.03583 0.217773 8.23661C0.273044 8.43738 0.386132 8.61747 0.542964 8.75447L4.9063 12.5811L3.6197 18.2489C3.57329 18.4522 3.58773 18.6646 3.66122 18.8598C3.73471 19.0549 3.86399 19.2241 4.03297 19.3463C4.21393 19.4778 4.43184 19.5488 4.65554 19.549C4.84761 19.5488 5.03599 19.4963 5.20053 19.3972L10.1798 16.4213L15.1573 19.3972C15.3356 19.5044 15.5414 19.5568 15.7492 19.5477C15.957 19.5387 16.1575 19.4686 16.3257 19.3463C16.4947 19.2241 16.6239 19.0548 16.6974 18.8597C16.7709 18.6646 16.7855 18.4522 16.7392 18.2489L15.4525 12.5811L19.8158 8.75532C19.9728 8.61822 20.086 8.43803 20.1414 8.23712C20.1969 8.03622 20.192 7.82346 20.1276 7.62527Z" fill="#FBBF24"/>
              </svg>
            {% endfor %}
          </div>
          <p class="text-sm leading-6 text-gray-700">{{ block.settings.text }}</p>
        </article>
      {%- endfor -%}
    </div>
  </div>

  <style>
    .slider {
      position: relative;
      width: 100%;
      display: grid;
      place-items: center;
      overflow: hidden;
    }
    .slider::before,
    .slider::after{
      position:absolute;
      background-image:linear-gradient(to right,rgba(255,255,255,1) 0%,rgba(255,255,255,0) 100%);
      content:'';
      height:100%;width:25%;
      z-index:2;pointer-events:none;
    }
    .slider::before{ left:0; top:0; }
    .slider::after{ right:0; top:0; transform:rotateZ(180deg); }

    /* Dinámico según nº de bloques (duplicamos el loop, por eso *2) */
    .slide-track {
      display:flex;
      justify-content:space-between;
      width: calc(350px * {{ slides_count | times: 2 | default: 2 }});
      animation: scroll 35s linear infinite;
    }

    @keyframes scroll {
      0%   { transform: translateX(0px); }
      100% { transform: translateX(calc(-150px * {{ slides_count | default: 1 }})); }
    }

    @media screen and (max-width: 768px) {
      .slide-track { width: calc(280px * {{ slides_count | times: 2 | default: 2 }}); }
      @keyframes scroll {
        0%   { transform: translateX(0px); }
        100% { transform: translateX(calc(-80px * {{ slides_count | default: 1 }})); }
      }
    }
  </style>

  <!-- Botón -->
  {% if section.settings.btn_label != blank and section.settings.btn_link != blank %}
    <a
      href="{{ section.settings.btn_link }}"
      class="shadow h-9 inline-flex items-center justify-center gap-2.5 py-8 px-12 rounded-[50px] btn-primary max-sm:w-[91%] md:w-1/2 lg:w-auto text-[18px] [@media(max-width:1024px)]:mx-6"
    >
      <span class="[font-family:'DM_Sans_18pt-SemiBold',Helvetica] font-semibold text-[18px]">
        {{- section.settings.btn_label -}}
      </span>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="w-[15px] h-[15px] ml-2"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        stroke-width="2"
        aria-hidden="true"
      >
        <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14M12 5l7 7-7 7" />
      </svg>
    </a>
  {% endif %}
</section>

{% schema %}
{
  "name": "Migraciones reviews",
  "tag": "section",
  "class": "t4s-section t4s-section-all t4s-custom-liquid",
  "settings": [
    { "type": "header", "content": "Contenido" },
    { "type": "text", "id": "title_prefix", "label": "Título – prefijo", "default": "Cómo funciona" },
    { "type": "text", "id": "title_highlight", "label": "Título – highlight", "default": "nuestra suscripción" },

    { "type": "image_picker", "id": "decor_image", "label": "Imagen decorativa (opcional)" },
    { "type": "text", "id": "decor_image_alt", "label": "Alt imagen decorativa", "default": "Decorativo" },

    { "type": "url", "id": "cards_link", "label": "Enlace de las cards (opcional)" },

    { "type": "header", "content": "Botón" },
    { "type": "text", "id": "btn_label", "label": "Texto del botón", "default": "Empezar mi plan con un -10%" },
    { "type": "url", "id": "btn_link", "label": "Enlace del botón" },

    { "type": "header", "content": "Colores" },
    { "type": "color", "id": "bg_color", "label": "Fondo de la sección", "default": "#ffffff" },
    { "type": "color", "id": "title_color", "label": "Color del título y números", "default": "#004623" },
    { "type": "color", "id": "highlight_color", "label": "Color del highlight", "default": "#004623" },
    { "type": "color", "id": "text_color", "label": "Color de textos", "default": "#004623" },
    { "type": "color", "id": "accent_color", "label": "Color acento (badge/botón)", "default": "#FFCD00" }
  ],
  "blocks": [
    {
      "type": "review",
      "name": "Review",
      "settings": [
        { "type": "image_picker", "id": "avatar", "label": "Avatar (opcional)" },
        { "type": "text", "id": "avatar_alt", "label": "Alt avatar", "default": "Avatar" },
        { "type": "text", "id": "name", "label": "Nombre", "default": "Cliente satisfecho" },
        { "type": "range", "id": "rating", "label": "Estrellas", "min": 1, "max": 5, "step": 1, "default": 5 },
        { "type": "textarea", "id": "text", "label": "Texto", "default": "Comentario del cliente." }
      ]
    }
  ],
  "max_blocks": 30,
  "presets": [
    {
      "name": "Migraciones reviews",
      "blocks": [
        { "type": "review", "settings": { "name": "María", "rating": 5, "text": "Servicio impecable." } },
        { "type": "review", "settings": { "name": "Javi", "rating": 5, "text": "Rápidos y efectivos." } },
        { "type": "review", "settings": { "name": "Laura", "rating": 4, "text": "Muy buena experiencia." } }
      ]
    }
  ]
}
{% endschema %}
