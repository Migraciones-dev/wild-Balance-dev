<section
  id="section-{{ section.id }}"
  class="w-full"
  style="
    background-color: {{ section.settings.bg_color }};
    padding-top: {{ section.settings.pt_mobile }}px;
    padding-bottom: {{ section.settings.pb_mobile }}px;
  "
>
  <style>
    @media (min-width: 768px) {
      #section-{{ section.id }} {
        padding-top: {{ section.settings.pt_desktop }}px !important;
        padding-bottom: {{ section.settings.pb_desktop }}px !important;
      }
    }

    {% for block in section.blocks %}
      @media (min-width: 768px) {
        #banner-{{ block.id }} .banner-image {
          border-radius: {{ block.settings.border_radius_desktop }}px !important;
        }
      }

      @media (max-width: 767px) {
        #banner-{{ block.id }} .banner-image {
          border-radius: {{ block.settings.border_radius_mobile }}px !important;
        }
      }

      #banner-{{ block.id }} {
        margin-top: {{ block.settings.mt_mobile }}px;
        margin-bottom: {{ block.settings.mb_mobile }}px;
      }

      @media (min-width: 768px) {
        #banner-{{ block.id }} {
          margin-top: {{ block.settings.mt_desktop }}px !important;
          margin-bottom: {{ block.settings.mb_desktop }}px !important;
        }
      }
    {% endfor %}
  </style>

  <div class="max-w-[1600px] mx-auto px-6 lg:px-10">
    {% for block in section.blocks %}
      {% if block.type == 'banner' %}
        {%- comment -%} Obtener la hora actual del servidor Shopify {%- endcomment -%}
        {%- assign current_time = 'now' | date: '%s' | plus: 0 -%}

        {%- comment -%} Procesar fechas ingresadas (formato: 2025-11-29 10:30) {%- endcomment -%}
        {%- assign show_banner = false -%}

        {%- if block.settings.enable_schedule == false -%}
          {%- comment -%} Si no est√° programado, siempre mostrar {%- endcomment -%}
          {%- assign show_banner = true -%}
        {%- else -%}
          {%- comment -%} Verificar si hay fechas configuradas {%- endcomment -%}
          {%- assign has_start = false -%}
          {%- assign has_end = false -%}

          {%- if block.settings.start_date != blank -%}
            {%- assign has_start = true -%}
            {%- comment -%} Convertir fecha de inicio a timestamp (formato: 2025-11-29 10:30) {%- endcomment -%}
            {%- assign start_time = block.settings.start_date | append: ':00' | date: '%s' | plus: 0 -%}
          {%- endif -%}

          {%- if block.settings.end_date != blank -%}
            {%- assign has_end = true -%}
            {%- comment -%} Convertir fecha de fin a timestamp (formato: 2025-12-20 23:00) {%- endcomment -%}
            {%- assign end_time = block.settings.end_date | append: ':00' | date: '%s' | plus: 0 -%}
          {%- endif -%}

          {%- comment -%} L√≥gica de visualizaci√≥n basada en fechas {%- endcomment -%}
          {%- if has_start and has_end -%}
            {%- comment -%} Ambas fechas definidas: verificar que est√© en el rango {%- endcomment -%}
            {%- if current_time >= start_time and current_time <= end_time -%}
              {%- assign show_banner = true -%}
            {%- endif -%}
          {%- elsif has_start and has_end == false -%}
            {%- comment -%} Solo inicio: mostrar desde la fecha de inicio en adelante {%- endcomment -%}
            {%- if current_time >= start_time -%}
              {%- assign show_banner = true -%}
            {%- endif -%}
          {%- elsif has_start == false and has_end -%}
            {%- comment -%} Solo fin: mostrar hasta la fecha de fin {%- endcomment -%}
            {%- if current_time <= end_time -%}
              {%- assign show_banner = true -%}
            {%- endif -%}
          {%- else -%}
            {%- comment -%} Sin fechas: mostrar siempre {%- endcomment -%}
            {%- assign show_banner = true -%}
          {%- endif -%}
        {%- endif -%}

        {%- if show_banner -%}
          <div id="banner-{{ block.id }}" {{ block.shopify_attributes }}>
            {%- if block.settings.desktop_image or block.settings.mobile_image -%}
              {%- comment -%} Si hay imagen de m√≥vil, usar responsive, si no, mostrar la de desktop en todos lados {%- endcomment -%}
              {% if block.settings.mobile_image %}
                {%- comment -%} Imagen escritorio {%- endcomment -%}
                {% if block.settings.desktop_image %}
                  {% if block.settings.image_link != blank %}<a href="{{ block.settings.image_link }}">{% endif %}
                  <img
                    src="{{ block.settings.desktop_image | img_url: '2048x' }}"
                    class="banner-image hidden md:block w-full h-auto object-cover"
                    alt="{{ block.settings.desktop_image.alt | escape }}"
                    loading="lazy"
                  >
                  {% if block.settings.image_link != blank %}</a>{% endif %}
                {% endif %}

                {%- comment -%} Imagen m√≥vil {%- endcomment -%}
                {% if block.settings.image_link != blank %}<a href="{{ block.settings.image_link }}">{% endif %}
                <img
                  src="{{ block.settings.mobile_image | img_url: '1024x' }}"
                  class="banner-image block md:hidden w-full h-auto object-cover"
                  alt="{{ block.settings.mobile_image.alt | escape }}"
                  loading="lazy"
                >
                {% if block.settings.image_link != blank %}</a>{% endif %}
              {% else %}
                {%- comment -%} Solo hay imagen desktop, mostrarla en todos los dispositivos {%- endcomment -%}
                {% if block.settings.desktop_image %}
                  {% if block.settings.image_link != blank %}<a href="{{ block.settings.image_link }}">{% endif %}
                  <img
                    src="{{ block.settings.desktop_image | img_url: '2048x' }}"
                    class="banner-image w-full h-auto object-cover"
                    alt="{{ block.settings.desktop_image.alt | escape }}"
                    loading="lazy"
                  >
                  {% if block.settings.image_link != blank %}</a>{% endif %}
                {% endif %}
              {% endif %}
            {%- endif -%}
          </div>
        {%- endif -%}
      {% endif %}
    {% endfor %}
  </div>
</section>

{% schema %}
{
  "name": "Banners responsivos",
  "settings": [
    {
      "type": "paragraph",
      "content": "‚ö†Ô∏è IMPORTANTE: Aseg√∫rate de que la zona horaria de tu tienda est√© configurada en 'Madrid' o '(GMT+01:00) Europe/Madrid' en Configuraci√≥n > General > Est√°ndares y formatos"
    },
    {
      "type": "header",
      "content": "Espaciado de secci√≥n - Desktop"
    },
    {
      "type": "range",
      "id": "pt_desktop",
      "label": "Padding superior (Desktop)",
      "min": 0,
      "max": 200,
      "step": 4,
      "unit": "px",
      "default": 40
    },
    {
      "type": "range",
      "id": "pb_desktop",
      "label": "Padding inferior (Desktop)",
      "min": 0,
      "max": 200,
      "step": 4,
      "unit": "px",
      "default": 40
    },
    {
      "type": "header",
      "content": "Espaciado de secci√≥n - M√≥vil"
    },
    {
      "type": "range",
      "id": "pt_mobile",
      "label": "Padding superior (M√≥vil)",
      "min": 0,
      "max": 200,
      "step": 4,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "pb_mobile",
      "label": "Padding inferior (M√≥vil)",
      "min": 0,
      "max": 200,
      "step": 4,
      "unit": "px",
      "default": 20
    },
    {
      "type": "header",
      "content": "Estilo"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Color de fondo de la secci√≥n",
      "default": "#FBF5E7"
    }
  ],
  "blocks": [
    {
      "type": "banner",
      "name": "Banner",
      "settings": [
        {
          "type": "header",
          "content": "Im√°genes"
        },
        {
          "type": "image_picker",
          "id": "desktop_image",
          "label": "Imagen escritorio"
        },
        {
          "type": "image_picker",
          "id": "mobile_image",
          "label": "Imagen m√≥vil (opcional)",
          "info": "Si no se a√±ade, se mostrar√° la imagen de escritorio en m√≥vil"
        },
        {
          "type": "url",
          "id": "image_link",
          "label": "Enlace de la imagen"
        },
        {
          "type": "header",
          "content": "‚è∞ Programaci√≥n de visualizaci√≥n (Hora de Espa√±a)"
        },
        {
          "type": "checkbox",
          "id": "enable_schedule",
          "label": "Activar programaci√≥n de fechas",
          "default": false,
          "info": "Activa para programar cu√°ndo se mostrar√° este banner"
        },
        {
          "type": "text",
          "id": "start_date",
          "label": "üìÖ Fecha y hora de INICIO (Espa√±a)",
          "placeholder": "2025-11-29 10:30",
          "info": "Formato: YYYY-MM-DD HH:MM (ejemplo: 2025-11-29 10:30). Hora de Espa√±a (CET/CEST). Dejar vac√≠o = desde siempre"
        },
        {
          "type": "text",
          "id": "end_date",
          "label": "üìÖ Fecha y hora de FIN (Espa√±a)",
          "placeholder": "2025-12-20 23:00",
          "info": "Formato: YYYY-MM-DD HH:MM (ejemplo: 2025-12-20 23:00). Hora de Espa√±a (CET/CEST). Dejar vac√≠o = sin l√≠mite"
        },
        {
          "type": "header",
          "content": "Border Radius"
        },
        {
          "type": "range",
          "id": "border_radius_desktop",
          "label": "Border radius (Desktop)",
          "min": 0,
          "max": 50,
          "step": 2,
          "unit": "px",
          "default": 30
        },
        {
          "type": "range",
          "id": "border_radius_mobile",
          "label": "Border radius (M√≥vil)",
          "min": 0,
          "max": 50,
          "step": 2,
          "unit": "px",
          "default": 12
        },
        {
          "type": "header",
          "content": "Espaciado - Desktop"
        },
        {
          "type": "range",
          "id": "mt_desktop",
          "label": "Margen superior (Desktop)",
          "min": 0,
          "max": 200,
          "step": 4,
          "unit": "px",
          "default": 0
        },
        {
          "type": "range",
          "id": "mb_desktop",
          "label": "Margen inferior (Desktop)",
          "min": 0,
          "max": 200,
          "step": 4,
          "unit": "px",
          "default": 0
        },
        {
          "type": "header",
          "content": "Espaciado - M√≥vil"
        },
        {
          "type": "range",
          "id": "mt_mobile",
          "label": "Margen superior (M√≥vil)",
          "min": 0,
          "max": 200,
          "step": 4,
          "unit": "px",
          "default": 0
        },
        {
          "type": "range",
          "id": "mb_mobile",
          "label": "Margen inferior (M√≥vil)",
          "min": 0,
          "max": 200,
          "step": 4,
          "unit": "px",
          "default": 0
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Banners responsivos",
      "blocks": [
        {
          "type": "banner"
        }
      ]
    }
  ]
}
{% endschema %}
