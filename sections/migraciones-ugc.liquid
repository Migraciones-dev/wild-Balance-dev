<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<section class="relative w-full">
  <section class="relative w-full bg-[#faf5e7] overflow-hidden">
    <div class="flex flex-col items-center gap-[60px] py-20 lg:py-[113px] max-w-[1600px] mx-auto lg:px-10">
      <header class="relative w-full  [@media(max-width:1024px)]:px-6">
        <div class="flex flex-col items-center gap-[17px]">
          <div class="flex flex-col items-center gap-2.5">
            <img
              class="h-[27px] sm:h-[37px] lg:h-[47px]"
              alt="Vector"
              src="https://cdn.shopify.com/s/files/1/0713/9898/1933/files/Capa_1_22.png?v=1753618747"
            >
          </div>

          <h2 class="top-0 left-0 [font-family:'Barlow',Helvetica] font-extrabold text-[#004623] lg:mb-10 text-[30px] sm:text-[38px] md:text-[44px] lg:text-[57px] xl:text-[64px] leading-[1] text-center ">
            La comunidad de <span class="highlight">Wild Balance</span>
          </h2>
        </div>
      </header>

      <div class="ugc-carousel-container relative w-full">
        <div class="ugc-carousel swiper-container overflow-hidden">
          <div class="ugc-carousel-wrapper swiper-wrapper">
            {% for block in section.blocks %}
              <div class="ugc-carousel-slide swiper-slide p-2" {{ block.shopify_attributes }}>
                <div class="ugc-video-wrapper relative w-full rounded-xl overflow-hidden">
                  <video
                    class="ugc-video w-full block"
                    src="{{ block.settings.video_url }}"
                    preload="metadata"
                    {% if block.settings.poster_url != blank %}
                      poster="{{ block.settings.poster_url | img_url: 'master' }}"
                    {% endif %}
                  ></video>
                  <div class="ugc-video-overlay absolute inset-0 bg-black/10 flex items-center justify-center cursor-pointer z-10">
                    <!-- SVG Play button -->
                    <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <g opacity="0.9">
                      <rect x="0.223145" y="0.306152" width="63.023" height="63.023" rx="31.5115" fill="#004623"/>
                      <g clip-path="url(#clip0_162_14579)">
                      <path d="M42.9764 30.6361L27.625 20.2964C26.551 19.5585 25.1697 20.2964 25.1697 21.4781V42.1575C25.1697 43.3392 26.551 44.0771 27.625 43.3392L42.9777 32.9995C43.7444 32.4086 43.7431 31.2269 42.9764 30.6361Z" fill="white"/>
                      </g>
                      </g>
                      <defs>
                      <clipPath id="clip0_162_14579">
                      <rect width="23.6336" height="23.6336" fill="white" transform="translate(22.5438 20.001)"/>
                      </clipPath>
                      </defs>
                    </svg>
                  </div>
                </div>
                {% if block.settings.caption != blank %}
                  <div class="text-center mt-2 text-[15px] text-[#222]">{{ block.settings.caption }}</div>
                {% endif %}
              </div>
            {% endfor %}
          </div>

          <!-- Navegación desktop (descomenta si la quieres visible) -->
          {%- comment -%}
            <button
              class="ugc-prev-button hidden lg:flex items-center justify-center absolute left-2 top-1/2 transform -translate-y-1/2 z-10 w-10 h-10 bg-white rounded-full shadow-md hover:bg-transparent"
              aria-label="Anterior"
            >
              ‹
            </button>
            <button
              class="ugc-next-button hidden lg:flex items-center justify-center absolute right-2 top-1/2 transform -translate-y-1/2 z-10 w-10 h-10 bg-white rounded-full shadow-md hover:bg-transparent"
              aria-label="Siguiente"
            >
              ›
            </button>
          {%- endcomment -%}
          <!-- Paginación móvil -->
        </div>
      </div>

      {% if section.settings.button_text != blank and section.settings.button_url != blank %}
        <a
          href="{{ section.settings.button_url }}"
          class="
            shadow h-9 inline-flex items-center justify-center gap-2.5 py-8 px-12 bg-[#ffcd00] rounded-[50px] text-[#004623] hover:bg-[#ffcd00]/90
            max-sm:w-[91%] md:w-1/2 lg:w-auto text-[18px]  [@media(max-width:1024px)]:mx-6
          "
        >
          <span class="[font-family:'DM_Sans_18pt-SemiBold',Helvetica] font-semibold text-[#004623] tracking-[0] leading-[26px] text-[18px] lg:text-[18px]">
            {{ section.settings.button_text }}
          </span>
          <svg width="22" height="23" viewBox="0 0 22 23" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12.4587 5.25439L17.6686 11.6536M17.6686 11.6536L12.4587 18.0528M17.6686 11.6536L4.27158 11.6536" stroke="#004623" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </a>
      {% endif %}
    </div>
  </section>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    new Swiper('.ugc-carousel', {
      loop: false,
      spaceBetween: 16,
      navigation: { nextEl: '.ugc-next-button', prevEl: '.ugc-prev-button' },
      breakpoints: { 0: { slidesPerView: 1.35 }, 768: { slidesPerView: 3 }, 1024: { slidesPerView: 4 } },
      touchRatio: 1,
    });

    document.querySelectorAll('.ugc-video-wrapper').forEach((wrapper) => {
      const video = wrapper.querySelector('video');
      const overlay = wrapper.querySelector('.ugc-video-overlay');

      overlay.addEventListener('click', (e) => {
        e.stopPropagation();
        overlay.style.display = 'none';
        video.play();
      });

      video.addEventListener('click', () => {
        if (video.paused) {
          video.play();
        } else {
          video.pause();
        }
      });

      video.addEventListener('play', () => {
        overlay.style.display = 'none';
      });

      video.addEventListener('pause', () => {
        overlay.style.display = 'flex';
      });
      video.addEventListener('ended', () => {
        overlay.style.display = 'flex';
      });
    });

    // Auto-pausa de otros vídeos al reproducir uno
    const allVideos = Array.from(document.querySelectorAll('.ugc-video-wrapper video'));
    allVideos.forEach((video) => {
      video.addEventListener('play', () => {
        allVideos.forEach((other) => {
          if (other !== video) {
            other.pause();
          }
        });
      });
    });
  });
</script>

{% schema %}
{
  "name": "Migraciones ugc",
  "tag": "section",
  "class": "t4s-section t4s-section-all t4s-custom-liquid",
  "settings": [
    {
      "type": "text",
      "id": "button_text",
      "label": "Texto del botón",
      "default": "Prueba Wild Balance"
    },
    {
      "type": "url",
      "id": "button_url",
      "label": "URL del botón"
    }
  ],
  "blocks": [
    {
      "type": "video",
      "name": "Slide vídeo",
      "settings": [
        {
          "type": "url",
          "id": "video_url",
          "label": "URL del vídeo (.mp4)"
        },
        {
          "type": "image_picker",
          "id": "poster_url",
          "label": "Imagen de portada (poster)",
          "info": "Opcional. Imagen mostrada antes de reproducir. IMPORTANTE: La resolución de la imagen debe ser la misma que la de el vídeo."
        },
        {
          "type": "text",
          "id": "caption",
          "label": "Texto/caption bajo el vídeo"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Migraciones ugc",
      "category": "Carrusel"
    }
  ]
}
{% endschema %}
