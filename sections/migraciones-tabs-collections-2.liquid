{% comment %}
  Sección: Comida a su medida (Perros / Gatos)
  - Título editable en dos partes: normal + destacada
  - Pestañas Perros / Gatos con etiquetas editables
  - Bloques independientes por categoría:
      * dog_item  -> tarjetas de Perros
      * cat_item  -> tarjetas de Gatos
  - Cada tarjeta: título, enlace e imagen
{% endcomment %}

<div class="max-w-[1600px] mx-auto pt-16 pb-4 lg:py-20 lg:px-10">
  <!-- Header -->
  <div class="lg:flex lg:items-center lg:justify-between mb-6 lg:flex-row">
    <h2 class="text-center top-0 left-0 [font-family:'Barlow',Helvetica] font-extrabold text-[#004623] lg:mb-10 text-[30px] sm:text-[38px] md:text-[44px] lg:text-[57px] xl:text-[64px]">
      {{ section.settings.heading_prefix | escape }}
      <span class="highlight">{{ section.settings.heading_highlight | escape }}</span>
    </h2>

    <div class="space-x-2 flex items-center justify-center flex-nowrap mt-14 lg:mt-0">
      <button
        data-tab="perros"
        class="px-10 py-4 rounded-full border border-[#004623] bg-[#004623] text-white font-medium focus:outline-none flex items-center justify-center flex-nowrap gap-4"
        id="boton-perros"
      >
        <svg
          width="24"
          height="21"
          viewBox="0 0 24 21"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          class="fill-current"
        >
          <path fill="currentColor" d="M23.8783 10.6675L22.1863 1.5994C22.1449 1.37836 22.0588 1.16811 21.9332 0.981591C21.8076 0.795068 21.6452 0.636212 21.4559 0.514791C21.2666 0.39337 21.0545 0.311951 20.8326 0.27554C20.6107 0.23913 20.3837 0.248498 20.1655 0.303068L20.1336 0.312342L14.7216 1.90854H10.0123L4.6003 0.317495L4.56836 0.30822C4.35021 0.25365 4.1232 0.244282 3.90129 0.280692C3.67939 0.317103 3.46728 0.398522 3.278 0.519943C3.08873 0.641364 2.92629 0.800221 2.80068 0.986743C2.67508 1.17327 2.58895 1.38351 2.54761 1.60455L0.855579 10.6675C0.783223 11.0305 0.836932 11.4073 1.00782 11.7356C1.17871 12.0639 1.45655 12.324 1.79537 12.4729C2.01239 12.5723 2.24811 12.6243 2.48681 12.6254C2.77252 12.6252 3.05293 12.5483 3.29882 12.4028V16.7473C3.29882 17.8405 3.73309 18.8889 4.50609 19.6619C5.27909 20.4349 6.32751 20.8692 7.42069 20.8692H17.3132C18.4064 20.8692 19.4548 20.4349 20.2278 19.6619C21.0008 18.8889 21.4351 17.8405 21.4351 16.7473V12.4039C21.6807 12.5492 21.9607 12.626 22.246 12.6264C22.485 12.6258 22.7211 12.5741 22.9385 12.475C23.2777 12.326 23.5559 12.0655 23.7268 11.7368C23.8977 11.4081 23.9512 11.0308 23.8783 10.6675Z"/>
        </svg>
        <span>{{ section.settings.dogs_label | escape }}</span>
      </button>

      <button
        data-tab="gatos"
        class="px-10 py-4 rounded-full border border-[#004623] text-[#004623] font-medium focus:outline-none flex items-center justify-center flex-nowrap gap-4"
        id="boton-gatos"
      >
        <svg
          class="fill-current"
          width="25"
          height="25"
          viewBox="0 0 25 25"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path fill="currentColor" d="M9.94365 13.6908C9.94365 13.9142 9.87742 14.1325 9.75334 14.3182C9.62926 14.5039 9.4529 14.6486 9.24656 14.7341C9.04022 14.8196 8.81318 14.8419 8.59413 14.7984C8.37508 14.7548 8.17387 14.6472 8.01595 14.4893C7.85803 14.3314 7.75048 14.1302 7.70691 13.9111C7.66334 13.6921 7.6857 13.465 7.77117 13.2587C7.85663 13.0524 8.00137 12.876 8.18707 12.7519C8.37277 12.6278 8.59109 12.5616 8.81443 12.5616C9.11392 12.5616 9.40114 12.6806 9.61291 12.8924C9.82468 13.1041 9.94365 13.3913 9.94365 13.6908ZM17.0954 12.5616C16.872 12.5616 16.6537 12.6278 16.468 12.7519C16.2823 12.876 16.1376 13.0524 16.0521 13.2587C15.9666 13.465 15.9443 13.6921 15.9878 13.9111C16.0314 14.1302 16.139 14.3314 16.2969 14.4893C16.4548 14.6472 16.656 14.7548 16.8751 14.7984C17.0941 14.8419 17.3212 14.8196 17.5275 14.7341C17.7338 14.6486 17.9102 14.5039 18.0343 14.3182C18.1584 14.1325 18.2246 13.9142 18.2246 13.6908C18.2246 13.3913 18.1056 13.1041 17.8938 12.8924C17.6821 12.6806 17.3949 12.5616 17.0954 12.5616ZM22.7415 5.03349V13.3144C22.7415 18.2952 18.3516 22.3482 12.9549 22.3482C7.55817 22.3482 3.16833 18.2952 3.16833 13.3144V5.03349C3.16847 4.73581 3.25685 4.44485 3.4223 4.19738C3.58775 3.94991 3.82285 3.75703 4.09788 3.64313C4.37291 3.52924 4.67553 3.49942 4.9675 3.55746C5.25947 3.61549 5.52769 3.75878 5.73825 3.9692C5.75142 3.98238 5.76271 3.99461 5.77401 4.00779L7.40291 5.88041C9.06845 4.8369 10.9942 4.28346 12.9596 4.28346C14.925 4.28346 16.8508 4.8369 18.5163 5.88041L20.1358 4.00779C20.1471 3.99461 20.1584 3.98238 20.1715 3.9692C20.3821 3.75878 20.6503 3.61549 20.9423 3.55746C21.2343 3.49942 21.5369 3.52924 21.8119 3.64313C22.087 3.75703 22.322 3.94991 22.4875 4.19738C22.6529 4.44485 22.7413 4.73581 22.7415 5.03349Z"/>
        </svg>
        <span>{{ section.settings.cats_label | escape }}</span>
      </button>
    </div>
  </div>

  <!-- Tab Content -->
  <div id="tab-content" class="my-10 lg:my-20">
    <!-- Perros -->
    <div id="perros" class="tab-panel">
      <div class="cards-container flex space-x-4 overflow-x-auto pb-4">
        {% for block in section.blocks %}
          {% if block.type == 'dog_item' %}
            {% assign img = block.settings.image %}
            <a
              href="{{ block.settings.url | escape }}"
              class="w-1/2 p-2 min-w-[75%] sm:min-w-[50%] md:min-w-[33.333%] lg:min-w-[25%] rounded-lg"
              {{ block.shopify_attributes }}
            >
              {% if img != blank %}
                {{
                  img
                  | image_url: width: 1000
                  | image_tag: alt: block.settings.title, class: 'w-full object-cover rounded-[8px]', draggable: 'false'
                }}
              {% endif %}
              <div class="p-4">
                <p class="text-sm font-semibold">{{ block.settings.title | escape }}</p>
              </div>
            </a>
          {% endif %}
        {% endfor %}
      </div>
    </div>

    <!-- Gatos -->
    <div id="gatos" class="tab-panel hidden">
      <div class="cards-container flex space-x-4 overflow-x-auto pb-4">
        {% for block in section.blocks %}
          {% if block.type == 'cat_item' %}
            {% assign img = block.settings.image %}
            <a
              href="{{ block.settings.url | escape }}"
              class="w-1/2 p-2 min-w-[75%] sm:min-w-[50%] md:min-w-[33.333%] lg:min-w-[25%] rounded-lg"
              {{ block.shopify_attributes }}
            >
              {% if img != blank %}
                {{
                  img
                  | image_url: width: 1000
                  | image_tag: alt: block.settings.title, class: 'w-full object-cover rounded-[8px]', draggable: 'false'
                }}
              {% endif %}
              <div class="p-4">
                <p class="text-sm font-semibold">{{ block.settings.title | escape }}</p>
              </div>
            </a>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<style>
  /* Custom scrollbar para las cards */
  .tab-panel .cards-container::-webkit-scrollbar { height: 6px; }
  .tab-panel .cards-container::-webkit-scrollbar-track { background: #e5e7eb; }
  .tab-panel .cards-container::-webkit-scrollbar-thumb { background-color: #047857; border-radius: 9999px; }
  .tab-panel .cards-container { scrollbar-width: thin; scrollbar-color: #047857 #e5e7eb; }
  .highlight { position: relative; }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const tabs = document.querySelectorAll('[data-tab]');
    const panels = document.querySelectorAll('.tab-panel');

    // Estado inicial: Perros activo
    const initial = document.querySelector('[data-tab="perros"]');
    if (initial) initial.classList.add('bg-[#004623]', 'text-white');

    tabs.forEach((tab) => {
      tab.addEventListener('click', () => {
        tabs.forEach((t) => t.classList.remove('bg-[#004623]', 'text-white', 'active'));
        tabs.forEach((t) => t.classList.add('text-[#004623]'));
        panels.forEach((p) => p.classList.add('hidden'));
        tab.classList.add('bg-[#004623]', 'text-white');
        tab.classList.remove('text-[#004623]');
        const target = document.getElementById(tab.getAttribute('data-tab'));
        if (target) target.classList.remove('hidden');
      });
    });

    // Drag scroll suave en desktop para cada carrusel
    if (window.innerWidth >= 1024) {
      document.querySelectorAll('.cards-container').forEach((slider) => {
        let isDown = false,
          startX = 0,
          scrollLeft = 0,
          isDragging = false;

        slider.querySelectorAll('a').forEach((link) => {
          link.addEventListener('dragstart', (e) => e.preventDefault());
          link.addEventListener('mousedown', (e) => e.preventDefault());
        });

        slider.addEventListener('mousedown', (e) => {
          isDown = true;
          isDragging = false;
          startX = e.pageX - slider.offsetLeft;
          scrollLeft = slider.scrollLeft;
        });
        slider.addEventListener('mouseleave', () => {
          isDown = false;
        });
        slider.addEventListener('mouseup', () => {
          isDown = false;
        });
        slider.addEventListener('mousemove', (e) => {
          if (!isDown) return;
          e.preventDefault();
          const x = e.pageX - slider.offsetLeft;
          const walk = x - startX;
          if (Math.abs(walk) > 5) isDragging = true;
          slider.scrollLeft = scrollLeft - walk;
        });
        slider.querySelectorAll('a').forEach((link) => {
          link.addEventListener('click', (e) => {
            if (isDragging) e.preventDefault();
          });
        });
      });
    }
  });
</script>

{% schema %}
{
  "name": "Comida a su medida",
  "tag": "section",
  "class": "t4s-section",
  "settings": [
    { "type": "text", "id": "heading_prefix", "label": "Título (parte normal)", "default": "Comida a" },
    { "type": "text", "id": "heading_highlight", "label": "Título (parte destacada)", "default": "su medida" },
    { "type": "text", "id": "dogs_label", "label": "Etiqueta pestaña Perros", "default": "Perros" },
    { "type": "text", "id": "cats_label", "label": "Etiqueta pestaña Gatos", "default": "Gatos" }
  ],
  "blocks": [
    {
      "type": "dog_item",
      "name": "Perros · tarjeta",
      "settings": [
        { "type": "text", "id": "title", "label": "Título", "default": "Título tarjeta" },
        { "type": "url", "id": "url", "label": "Enlace" },
        { "type": "image_picker", "id": "image", "label": "Imagen" }
      ]
    },
    {
      "type": "cat_item",
      "name": "Gatos · tarjeta",
      "settings": [
        { "type": "text", "id": "title", "label": "Título", "default": "Título tarjeta" },
        { "type": "url", "id": "url", "label": "Enlace" },
        { "type": "image_picker", "id": "image", "label": "Imagen" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Comida a su medida",
      "blocks": [{ "type": "dog_item" }, { "type": "dog_item" }, { "type": "cat_item" }, { "type": "cat_item" }]
    }
  ]
}
{% endschema %}
