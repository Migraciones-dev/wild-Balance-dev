{%- comment -%}
  Sección: Migraciones prod destacados
  - Grid configurable (móvil/tablet/desktop)
  - Bloques: banner + producto, con botón "Añadir al carrito" centrado y solapado
  - El botón usa el comportamiento AJAX del tema via `data-action-atc`
{%- endcomment -%}

{%- liquid
  assign sid = section.id
  assign cols_mb = section.settings.cols_mobile | default: '1' | plus: 0
  assign cols_md = section.settings.cols_tablet | default: 2
  assign cols_lg = section.settings.cols_desktop | default: 2
-%}

<section
  id="mig-prod-dest-{{ sid }}"
  class="w-full"
  style="
    background-color: {{ section.settings.bg_color }};
    padding-top: {{ section.settings.pt_mobile }}px;
    padding-bottom: {{ section.settings.pb_mobile }}px;
  "
>
  <style>
    @media (min-width: 768px) {
      #mig-prod-dest-{{ sid }} {
        padding-top: {{ section.settings.pt_desktop }}px !important;
        padding-bottom: {{ section.settings.pb_desktop }}px !important;
      }
    }
    @media (min-width: 1000px) {
      #mig-prod-dest-{{ sid }} .mig-container {
        width: 80%;
        max-width: 1400px;
      }
    }

    #mig-prod-dest-{{ sid }} .mig-grid {
      display: grid;
      grid-template-columns: repeat({{ cols_mb }}, minmax(0, 1fr));
      gap: {{ section.settings.gap_mobile }}px;
    }
    @media (min-width: 768px) {
      #mig-prod-dest-{{ sid }} .mig-grid {
        grid-template-columns: repeat({{ cols_md }}, minmax(0, 1fr));
        gap: {{ section.settings.gap_desktop }}px;
      }
    }
    @media (min-width: 1024px) {
      #mig-prod-dest-{{ sid }} .mig-grid {
        grid-template-columns: repeat({{ cols_lg }}, minmax(0, 1fr));
      }
    }
  </style>

  <div class="mig-container w-full max-w-[1400px] mx-auto px-6 lg:px-10">
    {%- if section.settings.title != blank -%}
      <div class="flex flex-col items-center gap-4 text-center">
        <h2 class="[font-family:'Barlow',Helvetica] font-extrabold text-[#004623] text-[30px] lg:text-[64px] leading-[1]">
          {{ section.settings.title }}
        </h2>
        {%- if section.settings.subtitle != blank -%}
          <p class="text-[#004623] text-[14px] lg:text-[18px] leading-[1.4] max-w-[900px]">
            {{ section.settings.subtitle }}
          </p>
        {%- endif -%}
      </div>
    {%- endif -%}

    <div class="mig-grid mt-10 lg:mt-16">
      {%- for block in section.blocks -%}
        {%- liquid
          assign b = block.settings
          assign product = b.product
          assign image = b.image
          if image == blank and product != blank
            assign image = product.featured_image
          endif
          assign variant = nil
          if product != blank
            assign variant = product.selected_or_first_available_variant
          endif
        -%}

        <div class="w-full pb-10" {{ block.shopify_attributes }}>
          <div class="relative">
            {%- if image != blank -%}
              {%- if b.link_image_to_product and product != blank -%}
                <a href="{{ product.url }}" class="block">
              {%- endif -%}

              <img
                src="{{ image | image_url: width: 1600 }}"
                alt="{{ image.alt | default: product.title | escape }}"
                loading="lazy"
                class="w-full h-auto object-cover rounded-[{{ b.border_radius }}px] border border-[#d9d9c8]"
              >

              {%- if b.link_image_to_product and product != blank -%}
                </a>
              {%- endif -%}
            {%- else -%}
              <div class="w-full aspect-[16/9] rounded-[{{ b.border_radius }}px] border border-[#d9d9c8] bg-white"></div>
            {%- endif -%}

            {%- assign btn_label = b.button_label | default: section.settings.button_label -%}
            {%- if btn_label != blank and product != blank and variant != blank -%}
	              <div class="absolute left-1/2 -translate-x-1/2 -bottom-5">
	                <a
	                  href="{{ product.url }}"
	                  rel="nofollow"
	                  data-action-atc
	                  data-variant-id="{{ variant.id }}"
	                  class="shadow inline-flex items-center justify-center gap-2.5 rounded-[50px] bg-[#ffcd00] text-[#004623] hover:no-underline hover:bg-[#ffcd00]/90 whitespace-nowrap px-5 py-3 text-[12px] lg:h-9 lg:px-12 lg:py-8 lg:text-[18px]"
	                  {% unless variant.available %}aria-disabled="true"{% endunless %}
	                >
	                  <span class="[font-family:'DM_Sans_18pt-SemiBold',Helvetica] font-semibold leading-none whitespace-nowrap">
	                    {%- if variant.available -%}
	                      {{ btn_label }}
	                    {%- else -%}
	                      {{ 'products.product.sold_out' | t }}
	                    {%- endif -%}
	                  </span>
	                </a>
	              </div>
            {%- endif -%}
          </div>

          {%- if b.show_product_title and product != blank -%}
            <div class="mt-2 text-center">
              <p class="[font-family:'Barlow',Helvetica] font-bold text-[#004623] text-[16px] lg:text-[20px] leading-[1.2]">
                {{ product.title }}
              </p>
            </div>
          {%- endif -%}
        </div>
      {%- endfor -%}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Migraciones destacados",
  "tag": "section",
  "class": "t4s-section t4s-section-all t4s-custom-liquid",
  "settings": [
    { "type": "header", "content": "Contenido" },
    { "type": "text", "id": "title", "label": "Título", "default": "Especial Navidad" },
    { "type": "textarea", "id": "subtitle", "label": "Subtítulo (opcional)" },
    { "type": "text", "id": "button_label", "label": "Texto del botón (por defecto)", "default": "Añadir al carrito" },

    { "type": "header", "content": "Layout" },
    { "type": "range", "id": "cols_desktop", "label": "Columnas desktop (≥1024px)", "min": 1, "max": 4, "step": 1, "default": 2 },
    { "type": "range", "id": "cols_tablet", "label": "Columnas tablet (≥768px)", "min": 1, "max": 3, "step": 1, "default": 2 },
    {
      "type": "select",
      "id": "cols_mobile",
      "label": "Columnas móvil (<768px)",
      "default": "1",
      "options": [
        { "value": "1", "label": "1 columna" },
        { "value": "2", "label": "2 columnas" }
      ]
    },
    { "type": "range", "id": "gap_desktop", "label": "Separación (tablet/desktop)", "min": 8, "max": 64, "step": 2, "unit": "px", "default": 24 },
    { "type": "range", "id": "gap_mobile", "label": "Separación (móvil)", "min": 8, "max": 48, "step": 2, "unit": "px", "default": 16 },

    { "type": "header", "content": "Espaciado" },
    { "type": "range", "id": "pt_desktop", "label": "Padding superior (Desktop)", "min": 0, "max": 200, "step": 4, "unit": "px", "default": 40 },
    { "type": "range", "id": "pb_desktop", "label": "Padding inferior (Desktop)", "min": 0, "max": 200, "step": 4, "unit": "px", "default": 40 },
    { "type": "range", "id": "pt_mobile", "label": "Padding superior (Móvil)", "min": 0, "max": 200, "step": 4, "unit": "px", "default": 20 },
    { "type": "range", "id": "pb_mobile", "label": "Padding inferior (Móvil)", "min": 0, "max": 200, "step": 4, "unit": "px", "default": 20 },

    { "type": "header", "content": "Colores" },
    { "type": "color", "id": "bg_color", "label": "Color de fondo", "default": "#ffffff" }
  ],
  "blocks": [
    {
      "type": "banner",
      "name": "Banner producto",
      "settings": [
        { "type": "product", "id": "product", "label": "Producto" },
        { "type": "image_picker", "id": "image", "label": "Imagen (opcional, si no se usa la del producto)" },
        { "type": "range", "id": "border_radius", "label": "Radio de bordes", "min": 0, "max": 32, "step": 2, "unit": "px", "default": 0 },
        { "type": "checkbox", "id": "link_image_to_product", "label": "Enlazar imagen al producto", "default": true },
        { "type": "text", "id": "button_label", "label": "Texto del botón (opcional)", "info": "Si se deja vacío, se usa el de la sección." },
        { "type": "checkbox", "id": "show_product_title", "label": "Mostrar nombre del producto debajo", "default": false }
      ]
    }
  ],
  "presets": [
    {
      "name": "Migraciones destacados",
      "blocks": [
        { "type": "banner" },
        { "type": "banner" }
      ]
    }
  ]
}
{% endschema %}
