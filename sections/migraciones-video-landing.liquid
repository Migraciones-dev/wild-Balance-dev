{% comment %}
  Seccion: Video landing (full width background)
  - Video con portada y boton play
  - Estilos editables (colores, paddings, radio, ancho maximo)
  - Titulo con highlight
{% endcomment %}

{%- liquid
  assign ratio_class = 'aspect-[9/16] lg:aspect-[16/9]'
  assign has_poster_desktop = false
  assign has_poster_mobile = false
  if section.settings.poster_image_desktop != blank
    assign has_poster_desktop = true
  endif
  if section.settings.poster_image_mobile != blank
    assign has_poster_mobile = true
  endif
  case section.settings.video_ratio
    when '16-9'
    when '4-5'
    when '1-1'
    when '9-16'
  endcase
-%}

<section
  id="mig-video-landing-{{ section.id }}"
  class="w-full"
  data-has-poster-desktop="{{ has_poster_desktop }}"
  data-has-poster-mobile="{{ has_poster_mobile }}"
  style="
    background-color: {{ section.settings.bg_color }};
    --pt-mobile: {{ section.settings.pt_mobile }}px;
    --pb-mobile: {{ section.settings.pb_mobile }}px;
    --pt-desktop: {{ section.settings.pt_desktop }}px;
    --pb-desktop: {{ section.settings.pb_desktop }}px;
  "
>
  <style>
    #mig-video-landing-{{ section.id }} {
      --title-color: {{ section.settings.title_color }};
      --text-color: {{ section.settings.text_color }};
      --highlight-color: {{ section.settings.highlight_color }};
      --accent-color: {{ section.settings.accent_color }};
      padding-top: var(--pt-mobile);
      padding-bottom: var(--pb-mobile);
    }
    #mig-video-landing-{{ section.id }} .mig-title { color: var(--title-color); }
    #mig-video-landing-{{ section.id }} .mig-highlight { color: var(--highlight-color); }
    #mig-video-landing-{{ section.id }} .mig-text { color: var(--text-color); }
    #mig-video-landing-{{ section.id }} .mig-btn {
      background: var(--accent-color);
      color: var(--title-color);
      width: min(92vw, 620px);
      text-align: center;
      white-space: nowrap;
    }
    #mig-video-landing-{{ section.id }} .mig-btn:hover { opacity: 0.9; }
    #mig-video-landing-{{ section.id }} .mig-video-frame {
      border-radius: {{ section.settings.video_radius_mobile }}px;
      overflow: hidden;
    }
    #mig-video-landing-{{ section.id }} .mig-video-hidden {
      display: none !important;
    }
    @media (min-width: 1024px) {
      #mig-video-landing-{{ section.id }} {
        padding-top: var(--pt-desktop);
        padding-bottom: var(--pb-desktop);
      }
      #mig-video-landing-{{ section.id }} .mig-video-frame {
        border-radius: {{ section.settings.video_radius_desktop }}px;
      }
      #mig-video-landing-{{ section.id }} .mig-btn {
        width: auto;
      }
    }
  </style>

  <div class="max-w-[1600px] mx-auto px-6 lg:px-10">
    <div class="flex flex-col items-center gap-8 lg:gap-10">
      {% if section.settings.decor_image != blank %}
        <img
          src="{{ section.settings.decor_image | image_url }}"
          alt="{{ section.settings.decor_image_alt | escape }}"
          class="h-[27px] sm:h-[37px] lg:h-[47px]"
          loading="lazy"
        >
      {% endif %}

      {% if section.settings.title_prefix != blank or section.settings.title_highlight != blank %}
        <h2 class="mig-title [font-family:'Barlow',Helvetica] font-extrabold text-center text-[26px] sm:text-[32px] lg:text-[40px] leading-tight">
          {{ section.settings.title_prefix }}
          {% if section.settings.title_highlight != blank %}
            <span class="highlight">{{ section.settings.title_highlight }}</span>
          {% endif %}
        </h2>
      {% endif %}

      {% if section.settings.subtitle != blank %}
        <div class="mig-text text-center text-[15px] sm:text-[16px] lg:text-[18px] leading-relaxed max-w-3xl">
          {{ section.settings.subtitle }}
        </div>
      {% endif %}

      <div
        class="w-full"
        style="max-width: {{ section.settings.video_max_width }}px;"
      >
        <div class="relative w-full {{ ratio_class }} mig-video-frame">
          <video
            class="absolute inset-0 h-full w-full object-cover hidden lg:block mig-video-desktop{% if has_poster_desktop %} mig-video-hidden{% endif %}"
            data-mig-video
            src="{{ section.settings.video_url_desktop }}"
            preload="metadata"
            playsinline
          ></video>
          <video
            class="absolute inset-0 h-full w-full object-cover block lg:hidden mig-video-mobile{% if has_poster_mobile %} mig-video-hidden{% endif %}"
            data-mig-video-mobile
            src="{{ section.settings.video_url_mobile }}"
            preload="metadata"
            playsinline
          ></video>

          <div class="absolute inset-0" data-mig-cover>
            {% if section.settings.poster_image_mobile != blank %}
              <img
                src="{{ section.settings.poster_image_mobile | image_url: width: 2000 }}"
                alt="{{ section.settings.poster_alt_mobile | escape }}"
                class="block lg:hidden h-full w-full object-cover"
                loading="lazy"
              >
            {% endif %}
            {% if section.settings.poster_image_desktop != blank %}
              <img
                src="{{ section.settings.poster_image_desktop | image_url: width: 2000 }}"
                alt="{{ section.settings.poster_alt_desktop | escape }}"
                class="hidden lg:block h-full w-full object-cover"
                loading="lazy"
              >
            {% endif %}

            <button
              type="button"
              aria-label="Reproducir video"
              data-mig-play
              class="absolute inset-0 grid place-items-center bg-transparent outline-none ring-0 border-0 p-0 m-0"
              style="appearance:none"
            >
              <svg
                width="85"
                height="99"
                viewBox="0 0 85 99"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <path d="M10 10.25L75 49.5L10 88.75V10.25Z" fill="#FFCD00" stroke="#FFCD00" stroke-width="19.0486" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
        </div>
      </div>

      {% if section.settings.button_label != blank and section.settings.button_link != blank %}
        <a
          href="{{ section.settings.button_link }}"
          class="mig-btn shadow inline-flex items-center justify-center gap-2.5 py-4 px-10 rounded-[50px] text-[16px] sm:text-[18px] font-semibold"
        >
          {{ section.settings.button_label }}
        </a>
      {% endif %}
    </div>
  </div>
</section>

<script>
  (() => {
    const section = document.getElementById('mig-video-landing-{{ section.id }}');
    if (!section) return;
    const video = section.querySelector('[data-mig-video]');
    const videoMobile = section.querySelector('[data-mig-video-mobile]');
    const cover = section.querySelector('[data-mig-cover]');
    const playBtn = section.querySelector('[data-mig-play]');
    const hasPosterDesktop = section.dataset.hasPosterDesktop === 'true';
    const hasPosterMobile = section.dataset.hasPosterMobile === 'true';
    if (!video || !cover || !playBtn) return;

    const showVideo = () => {
      cover.classList.add('hidden');
      if (window.matchMedia('(max-width: 1023px)').matches && videoMobile) {
        videoMobile.controls = true;
        videoMobile.classList.remove('mig-video-hidden');
      } else {
        video.controls = true;
        video.classList.remove('mig-video-hidden');
      }
    };

    const showCover = () => {
      if (video) {
        video.pause();
        video.controls = false;
        if (hasPosterDesktop) {
          video.classList.add('mig-video-hidden');
        }
      }
      if (videoMobile) {
        videoMobile.pause();
        videoMobile.controls = false;
        if (hasPosterMobile) {
          videoMobile.classList.add('mig-video-hidden');
        }
      }
      cover.classList.remove('hidden');
    };

    playBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      showVideo();
      const target = window.matchMedia('(max-width: 1023px)').matches && videoMobile ? videoMobile : video;
      target.muted = false;
      target.play();
    });

    video.addEventListener('pause', () => {
      if (!video.ended) showCover();
    });
    video.addEventListener('ended', showCover);
    if (videoMobile) {
      videoMobile.addEventListener('pause', () => {
        if (!videoMobile.ended) showCover();
      });
      videoMobile.addEventListener('ended', showCover);
    }
  })();
</script>

{% schema %}
{
  "name": "Video landing",
  "tag": "section",
  "class": "t4s-section t4s-section-all",
  "settings": [
    { "type": "header", "content": "Contenido" },
    { "type": "text", "id": "title_prefix", "label": "Titulo (prefijo)", "default": "Tu peludo, tu companero de" },
    { "type": "text", "id": "title_highlight", "label": "Titulo (highlight)", "default": "aventuras" },
    { "type": "richtext", "id": "subtitle", "label": "Subtitulo", "default": "<p>Descubre nuestra historia en este video.</p>" },
    { "type": "image_picker", "id": "decor_image", "label": "Imagen decorativa (encima del titulo)" },
    { "type": "text", "id": "decor_image_alt", "label": "Alt imagen decorativa", "default": "Decorativo" },

    { "type": "header", "content": "Video" },
    { "type": "url", "id": "video_url_desktop", "label": "URL video desktop (.mp4)" },
    { "type": "url", "id": "video_url_mobile", "label": "URL video movil (.mp4)" },
    { "type": "image_picker", "id": "poster_image_desktop", "label": "Imagen de portada desktop" },
    { "type": "image_picker", "id": "poster_image_mobile", "label": "Imagen de portada movil" },
    { "type": "text", "id": "poster_alt_desktop", "label": "Alt portada desktop", "default": "Portada del video" },
    { "type": "text", "id": "poster_alt_mobile", "label": "Alt portada movil", "default": "Portada del video" },
    {
      "type": "select",
      "id": "video_ratio",
      "label": "Relacion de aspecto",
      "default": "4-5",
      "options": [
        { "value": "16-9", "label": "16:9" },
        { "value": "4-5", "label": "4:5" },
        { "value": "9-16", "label": "9:16" },
        { "value": "1-1", "label": "1:1" }
      ]
    },
    { "type": "range", "id": "video_max_width", "label": "Ancho maximo del video", "min": 320, "max": 1400, "step": 20, "unit": "px", "default": 900 },
    { "type": "range", "id": "video_radius_desktop", "label": "Radio video desktop", "min": 0, "max": 60, "step": 2, "unit": "px", "default": 16 },
    { "type": "range", "id": "video_radius_mobile", "label": "Radio video movil", "min": 0, "max": 60, "step": 2, "unit": "px", "default": 12 },

    { "type": "header", "content": "Boton" },
    { "type": "text", "id": "button_label", "label": "Texto del boton", "default": "Ver mas" },
    { "type": "url", "id": "button_link", "label": "Link del boton" },

    { "type": "header", "content": "Colores" },
    { "type": "color", "id": "bg_color", "label": "Fondo seccion", "default": "#F7F2E6" },
    { "type": "color", "id": "title_color", "label": "Color titulo", "default": "#0B4D2A" },
    { "type": "color", "id": "text_color", "label": "Color texto", "default": "#0B4D2A" },
    { "type": "color", "id": "highlight_color", "label": "Color highlight", "default": "#0B4D2A" },
    { "type": "color", "id": "accent_color", "label": "Color boton", "default": "#F5C400" },

    { "type": "header", "content": "Espaciado" },
    { "type": "range", "id": "pt_desktop", "label": "Padding superior desktop", "min": 0, "max": 200, "step": 4, "unit": "px", "default": 48 },
    { "type": "range", "id": "pb_desktop", "label": "Padding inferior desktop", "min": 0, "max": 200, "step": 4, "unit": "px", "default": 48 },
    { "type": "range", "id": "pt_mobile", "label": "Padding superior movil", "min": 0, "max": 200, "step": 4, "unit": "px", "default": 32 },
    { "type": "range", "id": "pb_mobile", "label": "Padding inferior movil", "min": 0, "max": 200, "step": 4, "unit": "px", "default": 32 }
  ],
  "presets": [{ "name": "Video landing", "category": "Migraciones.io" }]
}
{% endschema %}
