/*
 * ------------------------------------------------------------
 * IMPORTANT: The contents of this file are auto-generated.
 *
 * This file may be updated by the Shopify admin theme editor
 * or related systems. Please exercise caution as any changes
 * made to this file may be overwritten.
 * ------------------------------------------------------------
 */
{
  "sections": {
    "heading": {
      "type": "heading-template",
      "blocks": {
        "b49343f1-a16f-4a0c-834a-46b77fe777da": {
          "type": "1",
          "settings": {
            "heading": "",
            "fontf": "2",
            "text_cl": "#004623",
            "text_fs": 50,
            "text_lh": 56,
            "text_fw": 900,
            "text_ls": 0,
            "font_italic": false,
            "font_uppercase": false,
            "text_shadow": false,
            "mgb": 0,
            "text_fs_tb": 30,
            "text_lh_tb": 46,
            "text_ls_tb": 0,
            "mgb_tb": 0,
            "hidden_mobile": false,
            "text_fs_mb": 30,
            "text_lh_mb": 46,
            "text_ls_mb": 0,
            "mgb_mb": 0
          }
        },
        "46ff9c32-9810-4c24-b2bd-9c6e38cc2ea8": {
          "type": "3",
          "disabled": true,
          "settings": {
            "breadcrumb_color": "#868686",
            "breadcrumb_color_link": "#000000",
            "brc_mgb": 0
          }
        }
      },
      "block_order": [
        "b49343f1-a16f-4a0c-834a-46b77fe777da",
        "46ff9c32-9810-4c24-b2bd-9c6e38cc2ea8"
      ],
      "disabled": true,
      "settings": {
        "parallax": false,
        "color": "#000000",
        "overlay": 0,
        "padding_top": 50,
        "padding_bottom": 50,
        "mg_b": 50,
        "padding_top_tb": 50,
        "padding_bottom_tb": 50,
        "mg_btb": 50,
        "padding_top_mb": 50,
        "padding_bottom_mb": 0,
        "mg_bmb": 27,
        "box_border": "none",
        "bg_pos": "center center",
        "bg_repeat": "no-repeat",
        "bg_size": "cover"
      }
    },
    "2fa35883-7762-4b11-9a64-3e08390ea41e": {
      "type": "custom-liquid",
      "settings": {
        "custom_liquid": "<div class=\"headerWizard\">\n<section class=\"logo\">\n<a href=\"https://wildbalance.es/\">\n<img src=\"https://cdn.shopify.com/s/files/1/0713/9898/1933/files/LOGO_1_1.png?v=1699453886\"/>\n</a>\n</section>\n\n<section class=\"wizardBubbleDiscount\">\n<div>\n<p>10% DESCUENTO</p>\n</div>\n</section>\n</div>"
      }
    },
    "custom_liquid_ibzxRE": {
      "type": "custom-liquid",
      "disabled": true,
      "settings": {
        "custom_liquid": "{% render 'wizard-resultpage-js' %}"
      }
    },
    "custom_liquid_BqAicP": {
      "type": "custom-liquid",
      "name": "Custom Liquid",
      "settings": {
        "custom_liquid": "<script>\nfunction prqQuizCallback(quizResponse){\n  try {\n    // --- IDs base ---\n    const quizId =\n      quizResponse.quizId || quizResponse.quizid || quizResponse.quiz?.id;\n    const responseId =\n      quizResponse.responseId ||\n      quizResponse.response?.attributes?.response_id ||\n      quizResponse.response?.id;\n\n    // --- Utilidades ---\n    const stripHTML = (html) => {\n      const d = document.createElement('div');\n      d.innerHTML = String(html || '');\n      return d.textContent.trim();\n    };\n    const sanitizeKey = (s) => String(s||\"\")\n      .toLowerCase()\n      .normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g,\"\")\n      .replace(/[^a-z0-9]+/g,\"_\").replace(/^_+|_+$/g,\"\");\n\n    // --- Aplana respuestas → valores cortos/limpios ---\n    const slides = quizResponse.quiz?.attributes?.slides?.data || [];\n    const answers = quizResponse.response?.attributes?.answers?.data || [];\n    const quizAnswers = {};\n    let petType = null, petName = null, weightKg = null, foodType = null;\n\n    answers.forEach((ans, idx) => {\n      const slideId = ans.attributes?.slide_id;\n      const slide   = slides.find(s => s.id === slideId);\n      const title   = stripHTML(slide?.attributes?.title || slide?.attributes?.description || 'q'+(idx+1));\n      const key     = `__prq_${idx+1}_${sanitizeKey(title).slice(0,24)}`;\n\n      // valor visible:\n      const choice = ans.attributes?.choice?.data?.attributes;\n      let value = \"\";\n      if (choice?.label) value = stripHTML(choice.label);\n      else if (Array.isArray(ans.attributes?.values) && ans.attributes.values.length)\n        value = String(ans.attributes.values[0]).trim();\n\n      quizAnswers[key] = value;\n\n      // intenta mapear campos típicos que el backend usa:\n      const t = title.toLowerCase();\n      if (!petType && /qué es el rey|perro|gato/.test(t))          petType = /gato/i.test(value) ? 'GATO' : 'PERRO';\n      if (!petName && /cómo se llama/.test(t))                      petName = value || null;\n      if (/cuánto pesa/.test(t)) {\n        const num = parseFloat(String(value).replace(',','.'));\n        if (!Number.isNaN(num) && Number.isFinite(num) && num > 0)  weightKg = num;\n      }\n      if (!foodType && /¿con qué prefieres empezar|dieta/i.test(t)) {\n        // resume dietas a tokens cortos\n        if (/cocinad/i.test(value))      foodType = 'cooked';\n        else if (/barf|cruda/i.test(value)) foodType = 'raw';\n      }\n    });\n\n    // --- Campos “mínimos útiles” del response ---\n    const attrs = quizResponse.response?.attributes || {};\n    const payload = {\n      quizId,\n      responseId,\n      klaviyoIdentify: quizResponse.klaviyoIdentify || {},\n      // compat extra (ligero):\n      permalink: attrs.permalink || null,\n      tags: attrs.tags || [],\n      selected_result_id: attrs.selected_result_id || null,\n      // campos directos saneados por si el backend los espera:\n      pet: petType,                // 'PERRO' | 'GATO'\n      pet_name: petName || null,   // string o null\n      weight_kg: weightKg,         // número o undefined\n      food_type: foodType,         // 'raw' | 'cooked' | undefined\n      // aplanado limpio\n      quizAnswers\n    };\n\n    console.log('payload_compat', payload);\n\n    // --- POST (sin adjuntar objetos gigantes) ---\n    fetch(\"https://wildbalance-app-rocket.fly.dev/insert-data\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json; charset=UTF-8\" },\n      body: JSON.stringify(payload)\n    })\n    .then(async (res) => {\n      const txt = await res.text().catch(()=> \"\");\n      if (!res.ok) throw new Error(`HTTP ${res.status} ${res.statusText} - ${txt}`);\n      let data = {};\n      try { data = txt ? JSON.parse(txt) : {}; } catch(e){}\n      // redirección\n      const destId = data.quizId || quizId;\n      window.location.href = \"https://wildbalance.es/pages/wizard-result/\" + destId;\n    })\n    .catch((err) => {\n      console.error('insert-data failed:', err);\n      // Fallback: ir a permalink nativo (para no romper UX)\n      const fallback = attrs.permalink;\n      if (fallback) window.location.href = fallback;\n    });\n\n  } catch (e) {\n    console.error('quizcallback error:', e);\n  }\n}\n</script>"
      }
    },
    "17007363095c6db749": {
      "type": "apps",
      "blocks": {
        "0ffae087-4c23-4da3-ad42-99aef600abfa": {
          "type": "shopify://apps/revenuehunt-quizzes/blocks/inline-quiz/672f3d48-fd3b-4227-8778-c6e58c4f8a98",
          "settings": {
            "quiz_id": "7jHvyKp",
            "quiz_height": 735,
            "quiz_autoscroll": false,
            "quiz_fixed_height": true
          }
        }
      },
      "block_order": [
        "0ffae087-4c23-4da3-ad42-99aef600abfa"
      ],
      "settings": {}
    },
    "main": {
      "type": "main-page",
      "settings": {
        "layout": "t4s-container-wrap",
        "cl_bg": "",
        "cl_bg_gradient": "",
        "mg": "60px,100px,60px,100px",
        "pd": "",
        "mg_tb": "20px,10px,30px,10px",
        "pd_tb": "",
        "mg_mb": "10px,10px,30px,10px",
        "pd_mb": ""
      }
    },
    "custom_liquid_HBy9ba": {
      "type": "custom-liquid",
      "settings": {
        "custom_liquid": "<style>\ndiv.rh-fullwidth .rh-widget.rh-inline.rh-quiz-GrHkMm{\n  height: 100vh !important;\n}\n</style>"
      }
    }
  },
  "order": [
    "heading",
    "2fa35883-7762-4b11-9a64-3e08390ea41e",
    "custom_liquid_ibzxRE",
    "custom_liquid_BqAicP",
    "17007363095c6db749",
    "main",
    "custom_liquid_HBy9ba"
  ]
}
