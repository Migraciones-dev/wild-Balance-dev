/*
 * ------------------------------------------------------------
 * IMPORTANT: The contents of this file are auto-generated.
 *
 * This file may be updated by the Shopify admin theme editor
 * or related systems. Please exercise caution as any changes
 * made to this file may be overwritten.
 * ------------------------------------------------------------
 */
{
  "sections": {
    "heading": {
      "type": "heading-template",
      "blocks": {
        "b49343f1-a16f-4a0c-834a-46b77fe777da": {
          "type": "1",
          "settings": {
            "heading": "",
            "fontf": "2",
            "text_cl": "#004623",
            "text_fs": 50,
            "text_lh": 56,
            "text_fw": 900,
            "text_ls": 0,
            "font_italic": false,
            "font_uppercase": false,
            "text_shadow": false,
            "mgb": 0,
            "text_fs_tb": 30,
            "text_lh_tb": 46,
            "text_ls_tb": 0,
            "mgb_tb": 0,
            "hidden_mobile": false,
            "text_fs_mb": 30,
            "text_lh_mb": 46,
            "text_ls_mb": 0,
            "mgb_mb": 0
          }
        },
        "46ff9c32-9810-4c24-b2bd-9c6e38cc2ea8": {
          "type": "3",
          "disabled": true,
          "settings": {
            "breadcrumb_color": "#868686",
            "breadcrumb_color_link": "#000000",
            "brc_mgb": 0
          }
        }
      },
      "block_order": [
        "b49343f1-a16f-4a0c-834a-46b77fe777da",
        "46ff9c32-9810-4c24-b2bd-9c6e38cc2ea8"
      ],
      "disabled": true,
      "settings": {
        "parallax": false,
        "color": "#000000",
        "overlay": 0,
        "padding_top": 50,
        "padding_bottom": 50,
        "mg_b": 50,
        "padding_top_tb": 50,
        "padding_bottom_tb": 50,
        "mg_btb": 50,
        "padding_top_mb": 50,
        "padding_bottom_mb": 0,
        "mg_bmb": 27,
        "box_border": "none",
        "bg_pos": "center center",
        "bg_repeat": "no-repeat",
        "bg_size": "cover"
      }
    },
    "2fa35883-7762-4b11-9a64-3e08390ea41e": {
      "type": "custom-liquid",
      "settings": {
        "custom_liquid": "<div class=\"headerWizard\">\n<section class=\"logo\">\n<a href=\"https://wildbalance.es/\">\n<img src=\"https://cdn.shopify.com/s/files/1/0713/9898/1933/files/LOGO_1_1.png?v=1699453886\"/>\n</a>\n</section>\n\n<section class=\"wizardBubbleDiscount\">\n<div>\n<p>10% DESCUENTO</p>\n</div>\n</section>\n</div>"
      }
    },
    "custom_liquid_ibzxRE": {
      "type": "custom-liquid",
      "disabled": true,
      "settings": {
        "custom_liquid": "{% render 'wizard-resultpage-js' %}"
      }
    },
    "custom_liquid_BqAicP": {
      "type": "custom-liquid",
      "name": "Custom Liquid",
      "settings": {
        "custom_liquid": "<script>\nfunction prqQuizCallback(quizResponse){\n  try {\n    // 1) Extrae ids\n    const quizId =\n      quizResponse.quizId || quizResponse.quizid || quizResponse.quiz?.id;\n    const responseId =\n      quizResponse.responseId ||\n      quizResponse.response?.attributes?.response_id ||\n      quizResponse.response?.id;\n\n    // 2) Aplana respuestas -> quizAnswers (estilo __prq_X_título...)\n    const answers = quizResponse.response?.attributes?.answers?.data || [];\n    const quizAnswers = {};\n    const sanitize = (s) =>\n      String(s || \"\")\n        .toLowerCase()\n        .normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\") // quita acentos\n        .replace(/[^a-z0-9]+/g, \"_\")                      // no alfanum = _\n        .replace(/^_+|_+$/g, \"\");                         // bordes\n\n    answers.forEach((ans, idx) => {\n      const slideId = ans.attributes?.slide_id;\n      const slide =\n        quizResponse.quiz?.attributes?.slides?.data?.find(s => s.id === slideId);\n      const titleRaw = slide?.attributes?.title || slide?.attributes?.description || \"no_title\";\n      const key = `__prq_${idx+1}_${sanitize(titleRaw).slice(0,24)}`; // como en el viejo\n      let value;\n\n      // Si es opción elegida, coge la etiqueta visible; si es campo libre, coge el texto\n      const choice = ans.attributes?.choice?.data?.attributes;\n      if (choice?.label) {\n        // quita HTML si viniera enriquecido\n        const div = document.createElement('div');\n        div.innerHTML = choice.label;\n        value = div.textContent.trim() || choice.label;\n      } else if (Array.isArray(ans.attributes?.values) && ans.attributes.values.length) {\n        value = ans.attributes.values[0];\n      } else {\n        value = \"\";\n      }\n      quizAnswers[key] = value;\n    });\n\n    // 3) Monta payload compatible con el backend antiguo\n    const payload = {\n      quizId,\n      responseId,\n      klaviyoIdentify: quizResponse.klaviyoIdentify || {}, // si viene\n      recommended_products: quizResponse.recommended_products || [],\n      // OJO: algunos payloads antiguos también añadían selected_result, envíalo si lo tienes:\n      selected_result: quizResponse.response?.attributes?.selected_result || undefined,\n      quizAnswers\n    };\n\n    console.log('payload_compat', payload);\n\n    // 4) POST\n    const url = \"https://wildbalance-app-rocket.fly.dev/insert-data\";\n    fetch(url, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json; charset=UTF-8\" },\n      body: JSON.stringify(payload)\n    })\n    .then(async (res) => {\n      if (!res.ok) {\n        const t = await res.text().catch(()=> \"\");\n        throw new Error(`HTTP ${res.status} ${res.statusText} - ${t}`);\n      }\n      return res.json();\n    })\n    .then((data) => {\n      // redirección como antes\n      window.location.href = \"https://wildbalance.es/pages/wizard-result/\" + (data.quizId || quizId);\n    })\n    .catch((err) => {\n      console.error('insert-data failed:', err);\n    });\n\n  } catch (e) {\n    console.error('quizcallback error:', e);\n  }\n}\n</script>"
      }
    },
    "17007363095c6db749": {
      "type": "apps",
      "blocks": {
        "0ffae087-4c23-4da3-ad42-99aef600abfa": {
          "type": "shopify://apps/revenuehunt-quizzes/blocks/inline-quiz/672f3d48-fd3b-4227-8778-c6e58c4f8a98",
          "settings": {
            "quiz_id": "7jHvyKp",
            "quiz_height": 735,
            "quiz_autoscroll": false,
            "quiz_fixed_height": true
          }
        }
      },
      "block_order": [
        "0ffae087-4c23-4da3-ad42-99aef600abfa"
      ],
      "settings": {}
    },
    "main": {
      "type": "main-page",
      "settings": {
        "layout": "t4s-container-wrap",
        "cl_bg": "",
        "cl_bg_gradient": "",
        "mg": "60px,100px,60px,100px",
        "pd": "",
        "mg_tb": "20px,10px,30px,10px",
        "pd_tb": "",
        "mg_mb": "10px,10px,30px,10px",
        "pd_mb": ""
      }
    },
    "custom_liquid_HBy9ba": {
      "type": "custom-liquid",
      "settings": {
        "custom_liquid": "<style>\ndiv.rh-fullwidth .rh-widget.rh-inline.rh-quiz-GrHkMm{\n  height: 100vh !important;\n}\n</style>"
      }
    }
  },
  "order": [
    "heading",
    "2fa35883-7762-4b11-9a64-3e08390ea41e",
    "custom_liquid_ibzxRE",
    "custom_liquid_BqAicP",
    "17007363095c6db749",
    "main",
    "custom_liquid_HBy9ba"
  ]
}
